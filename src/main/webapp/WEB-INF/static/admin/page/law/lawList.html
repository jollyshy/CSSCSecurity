<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>后台管理</title>
    <link rel="stylesheet" type="text/css" href="../../asset/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../../asset/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="../../css/common.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/main.css"/>
</head>
<body>
<div class="container" id="MainView">
</div>
<script type="text/template" id="mainView_template">
    <div class="crumb-wrap">
        基础数据管理>>法律法规
    </div>
    <div class="search-wrap">
        <div class="search-content">
            <table class="search-tab">
                <tr>
                    <!--<th width="70">关键字:</th>-->
                    <td>
                        <select name="condition" class="required" style="width:150px;height:30px;">
                            <option value="">输入查询条件</option>
                            <option value="category">分类</option>
                            <option value="keywords">关键词</option>
                            <option value="name">标准名称</option>
                        </select>
                    </td>
                    <td>
                        <input class="common-text required" size="30" value="" type="text">
                    </td>
                    <td>
                        <button type="button" class="btn btn-primary" id="js_query">查询</button>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div class="result-wrap">
        <h3 class="controll-title">信息管理</h3>
        <div class="result-title">
            <div class="result-list">
                <a href="law.html" id='js_create' class="btn btn-success" target="_blank"><i
                        class="icon-plus icon-large"></i>添加</a>
                <a href="#" class="btn btn-danger">
                    <i class="icon-trash icon-large"></i>删除</a>
            </div>
        </div>
        <div class="result-content">
            <table class="result-tab" width="100%">
                <thead>
                <tr>
                    <!-- <th class="tc" width="5%"><input class="allChoose" name="" type="checkbox"></th> -->
                    <th>排序</th>
                    <th>ID</th>
                    <th>名称</th>
                    <th>文号</th>
                    <th>单位</th>
                    <th>生效日期</th>
                    <th>预计失效日期</th>
                    <th>发布人</th>
                    <th>发布时间</th>
                    <th>浏览次数</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody id="RowView">
                </tbody>
            </table>
        </div>
    </div>
</script>

<script type="text/template" id="rowView-template">
    <td>
        <input class="common-input sort-input" name="ord[]" value='<%=id %>' type="text">
    </td>
    <td><%=id %></td>
    <td><a target="_blank" href="#"><%= name %></a></td>
    <td><%=no %></td>
    <td><%=publishDep %></td>
    <td><%=this.switchDate(effectiveDate) %></td>
    <td><%=this.switchDate(expiredDate) %></td>
    <td><%=publisher %></td>
    <td><%= this.switchDate(publishDate) %></td>
    <td><%=viewCount %></td>
    <td>
        <a class="link-update" href="law.html?id=<%=id %>" target="_blank">
            <i class="icon-edit icon-large"></i>
        </a>
        <a class="link-del" href="#" id="js-delete">
            <i class="icon-trash icon-large"></i>
        </a>
    </td>
</script>


</body>
<!-- Javascript -->
<script type="text/javascript" src="../../js/jquery-1.8.0.min.js"></script>
<script type="text/javascript" src="../../js/moment.js"></script>
<script type="text/javascript" src="../../js/jquery.json.js"></script>
<script type="text/javascript" src="../../js/Underscore.js"></script>
<script type="text/javascript" src="../../js/Backbone.js"></script>
<script type="text/javascript" src="../../js/backbone.layoutmanager.js"></script>
<script type="text/javascript" src="../../entities/entities.js"></script>
<script type="text/javascript" src="../../handle/law/law.js"></script>
</html>
<script type="text/javascript">
    (function (Backbone, _) {
        var LawCollection = new Entities.Law.Collection();
        var LawModel = new Entities.Law.Model();
        var EventBus = _.extend({}, Backbone.Events);
        Backbone.Layout.configure({
            manage: true
        });
        var RowView = Backbone.View.extend({
            template: '#rowView-template',
            tagName: 'tr',
            initialize: function () {
                this.listenTo(this.model, 'change', this.render);
                this.listenTo(this.model, 'destroy', this.handle);

            },
            handle: function () {
                this.remove();
            },
            events: {
                'click #js-edit': '_onEditLaw',
                'click #js-delete': '_onDeleteLaw',
            },
            switchDate: function (data) {
                var date = moment(data).format('YYYY-MM-DD');
                return date;
            },
            _onDeleteLaw: function () {
                this.model.delete();
            }
        });
        var MainView = Backbone.View.extend({
            template: '#mainView_template',
            initialize: function () {
                this.listenTo(LawCollection, 'reset', this.addAll);
                LawCollection.fetch();
            },
            events: {
                "click #js_query": '_onShowLawList'
            },
            _onShowLawList: function () {
                var key = $('select').val();
                var value = $("input").val();
                var data = {};
                if (key && value) {
                    data[key] = value;
                    LawCollection.fetch(data);
                    this.render();
                }
            },
            addOne: function (LawModel) {
                var rowView = new RowView({model: LawModel});
                this.insertView('#RowView', rowView).render();
            },
            addAll: function () {
                LawCollection.each(this.addOne, this);
            },
        });
        new MainView({el: '#MainView'}).render();
    })(Backbone, _);
</script>
